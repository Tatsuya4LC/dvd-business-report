--a function to get the top 3 most frequent film genre for each customer
CREATE OR REPLACE FUNCTION favorite(c_id INT)
    RETURNS TEXT
        LANGUAGE PLPGSQL
        AS
        $$ 
        DECLARE fav_genre INT;
        BEGIN
            SELECT STRING_AGG(name, ', ') INTO fav_genre
			    FROM customer_genre
    			WHERE customer_id = c_id
	    		GROUP BY customer_genre.times_rented
		    	ORDER BY times_rented DESC
			    LIMIT 3;
            RETURN fav_genre;
        END
        $$;